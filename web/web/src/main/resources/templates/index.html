<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>VitalSync</title>

        <!-- Bootstrap 5 CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Google Fonts (Inter) -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <!-- Iconos Phosphor -->
        <script src="https://unpkg.com/@phosphor-icons/web"></script>

        <link rel="manifest" href="/manifest.json">
        <meta name="theme-color" content="#00695c">

        <style>
            /* --- TEMA MODERNO PRO --- */
            :root {
                --primary: #00695c;
                --primary-light: #b2dfdb;
                --secondary: #004d40;
                --accent: #26a69a;
                --bg-color: #f8fafc;
                --text-main: #1e293b;
                --text-muted: #64748b;
                --card-bg: #ffffff;
                --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
                --shadow-hover: 0 10px 25px -5px rgba(0, 77, 64, 0.15);
                --radius-lg: 20px;
            }

            html, body {
                margin: 0;
                padding: 0;
                width: 100%;
                overflow-x: hidden;
            }

            body {
                background-color: var(--bg-color);
                padding-bottom: 110px;
                font-family: 'Inter', sans-serif;
                color: var(--text-main);
                -webkit-tap-highlight-color: transparent;
            }

            /* HEADER */
            .header-app {
                background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
                color: white;
                padding: 25px 24px 45px;
                border-bottom-left-radius: 30px;
                border-bottom-right-radius: 30px;
                box-shadow: 0 4px 20px rgba(0, 77, 64, 0.25);
                margin-bottom: -30px;
                position: relative;
                z-index: 10;
            }

            .user-avatar {
                width: 48px;
                height: 48px;
                background: rgba(255,255,255,0.2);
                backdrop-filter: blur(5px);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                border: 2px solid rgba(255,255,255,0.3);
            }

            /* LOGO */
            .logo-img {
                height: 40px;
                width: auto;
                background: rgba(255,255,255,0.95);
                padding: 4px;
                border-radius: 10px;
                margin-right: 12px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            /* TARJETAS DE NAVEGACI√ìN */
            .nav-card {
                background: var(--card-bg);
                border: 1px solid #f1f5f9;
                border-radius: var(--radius-lg);
                padding: 20px;
                box-shadow: var(--shadow-sm);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .nav-card:active {
                transform: scale(0.98);
                background-color: #f1f5f9;
            }

            .nav-card-icon {
                width: 60px;
                height: 60px;
                border-radius: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
            }

            /* TARJETA PR√ìXIMA CITA */
            .next-appt-card {
                background: white;
                border-left: 6px solid #f59e0b;
                border-radius: var(--radius-lg);
                padding: 20px;
                margin-bottom: 25px;
                box-shadow: 0 4px 15px rgba(245, 158, 11, 0.1);
            }

            /* INPUTS */
            .input-fecha-pro {
                border: 2px solid #e2e8f0;
                background-color: white;
                border-radius: 12px;
                padding: 14px;
                font-size: 1.1rem;
                width: 100%;
                font-weight: 500;
                color: var(--text-main);
            }
            .input-fecha-pro:focus {
                outline: none;
                border-color: var(--primary);
            }

            /* TARJETAS DE CITA */
            .card-cita {
                border: none;
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow-sm);
                margin-bottom: 16px;
                background: var(--card-bg);
                position: relative;
                overflow: hidden;
            }
            .card-cita::before {
                content: '';
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                width: 6px;
                background: var(--primary);
            }
            .card-cita.confirmada::before {
                background: #10b981;
            }

            .date-badge {
                background: #f1f5f9;
                padding: 10px;
                border-radius: 12px;
                text-align: center;
                min-width: 75px;
            }
            .date-day {
                font-size: 1.4rem;
                font-weight: 800;
                line-height: 1;
                color: var(--text-main);
            }
            .date-month {
                font-size: 0.75rem;
                font-weight: 700;
                text-transform: uppercase;
                color: var(--text-muted);
            }

            /* BOTONES */
            .btn-reservar {
                background-color: var(--primary);
                color: white;
                border: none;
                border-radius: 14px;
                padding: 16px;
                font-weight: 700;
                width: 100%;
                font-size: 1.1rem;
                box-shadow: 0 4px 12px rgba(0, 105, 92, 0.3);
            }
            .btn-reservar:active {
                background-color: var(--secondary);
                opacity: 0.9;
            }

            .btn-cancelar {
                background-color: #fef2f2;
                color: #dc2626;
                border: 2px solid #fecaca;
                width: 100%;
                padding: 14px;
                border-radius: 14px;
                font-weight: bold;
                font-size: 1rem;
            }

            /* Bot√≥n de Confirmaci√≥n en Modal Cancelar */
            .btn-confirmar-cancelacion {
                background-color: #dc2626;
                color: white;
                border: none;
                width: 100%;
                padding: 16px;
                border-radius: 14px;
                font-weight: 700;
                font-size: 1.1rem;
                box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            }

            /* MEN√ö INFERIOR */
            .bottom-nav {
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(12px);
                height: 75px;
                border-radius: 24px;
                display: flex;
                justify-content: space-around;
                align-items: center;
                box-shadow: 0 8px 32px rgba(0,0,0,0.1);
                z-index: 2000;
                border: 1px solid rgba(255,255,255,0.5);
            }
            .nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-decoration: none;
                color: #94a3b8;
                font-weight: 600;
                font-size: 0.75rem;
                width: 60px;
                height: 100%;
                transition: color 0.2s;
                cursor: pointer;
            }
            .nav-item i {
                font-size: 1.8rem;
                margin-bottom: 2px;
            }
            .nav-item.active {
                color: var(--primary);
            }
            .nav-item.active i {
                font-weight: bold;
                transform: translateY(-2px);
            }

            /* VISTAS */
            .vista {
                display: none;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .vista-activa {
                display: block;
                opacity: 1;
            }
            .hidden-by-filter {
                display: none !important;
            }

            /* MODAL */
            .modal-content {
                border-radius: 28px;
                border: none;
                box-shadow: 0 20px 50px rgba(0,0,0,0.25);
            }

            .confirm-section {
                background-color: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 16px;
                padding: 20px;
                margin-bottom: 15px;
                text-align: center;
            }

            .confirm-label {
                font-size: 0.8rem;
                color: #64748b;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 5px;
            }

            .confirm-value {
                font-size: 1.3rem;
                color: #0f172a;
                font-weight: 800;
                line-height: 1.2;
            }

            .confirm-value-highlight {
                color: var(--primary);
                font-size: 1.5rem;
            }

            /* Alerta de Regla 24h */
            .alert-regla {
                background-color: #fff7ed;
                border: 1px solid #ffedd5;
                color: #9a3412;
                padding: 15px;
                border-radius: 12px;
                font-size: 0.9rem;
                text-align: left;
                display: flex;
                gap: 10px;
                align-items: start;
            }

        </style>
    </head>
    <body>

        <!-- ================= VISTA 1: INICIO ================= -->
        <div id="vista-inicio" class="vista vista-activa">

            <div class="header-app">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <img src="/img/logo.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
                        <div>
                            <span class="badge bg-black bg-opacity-20 mb-1 fw-normal px-2 py-1">Bienvenido</span>
                            <h2 class="m-0 text-white fw-bold" style="font-size: 1.5rem;" th:text="${usuario.nombreCompleto.split(' ')[0]}">Paciente</h2>
                        </div>
                    </div>
                    <div class="user-avatar"><i class="ph ph-user"></i></div>
                </div>
            </div>

            <div class="container" style="margin-top: 40px;">

                <!-- Alertas -->
                <div th:if="${mensaje}" class="alert shadow-sm border-0 p-3 mb-4 rounded-4" 
                     th:classappend="${tipo == 'success' ? 'bg-success-subtle text-success-emphasis' : 'bg-danger-subtle text-danger-emphasis'}" role="alert">
                    <div class="d-flex align-items-center gap-3">
                        <i th:class="${tipo == 'success' ? 'ph-fill ph-check-circle fs-2' : 'ph-fill ph-warning-circle fs-2'}"></i>
                        <div>
                            <strong class="d-block" th:text="${tipo == 'success' ? '¬°√âxito!' : 'Atenci√≥n'}">Aviso</strong>
                            <span th:text="${mensaje}">Texto</span>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" style="position:absolute; top:15px; right:15px;"></button>
                </div>

                <!-- TARJETA PR√ìXIMA CITA -->
                <div th:if="${not #lists.isEmpty(misCitas)}" class="next-appt-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-bold text-uppercase small text-warning-emphasis" style="letter-spacing: 1px;">üîî Su pr√≥xima atenci√≥n</span>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-warning bg-opacity-10 p-3 rounded-4 text-center text-warning-emphasis" style="min-width: 80px;">
                            <div class="small fw-bold text-uppercase" th:text="${#temporals.format(misCitas[0].fechaHora, 'MMM')}">DIC</div>
                            <div class="fs-1 fw-bold" style="line-height:1" th:text="${#temporals.format(misCitas[0].fechaHora, 'dd')}">04</div>
                        </div>
                        <div>
                            <h5 class="mb-0 fw-bold text-dark" th:text="${misCitas[0].nombreMedico}">Dr. Nombre</h5>
                            <div class="text-muted small mb-2" th:text="${misCitas[0].especialidad}">Especialidad</div>
                            <div class="badge bg-warning text-dark bg-opacity-25 rounded-pill px-3">
                                <i class="ph-bold ph-clock me-1"></i> <span th:text="${#temporals.format(misCitas[0].fechaHora, 'HH:mm')}">10:00</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="navegar('citas')" class="btn btn-outline-warning w-100 rounded-pill mt-3 fw-bold border-2">Ver Detalles</button>
                </div>

                <div th:if="${#lists.isEmpty(misCitas)}" class="welcome-card p-4 rounded-4 bg-white shadow-sm border-start border-5 border-primary mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="fw-bold text-primary mb-1">¬°Hola! üëã</h4>
                            <p class="text-muted mb-0 small">¬øC√≥mo est√° su salud hoy?</p>
                        </div>
                        <i class="ph-duotone ph-heartbeat fs-1 text-primary opacity-50"></i>
                    </div>
                </div>

                <!-- ACCESOS R√ÅPIDOS -->
                <h6 class="mb-3 text-muted ps-2 fw-bold text-uppercase small">¬øQu√© desea hacer?</h6>
                <div class="row g-3">
                    <div class="col-12">
                        <div onclick="navegar('buscar')" class="nav-card">
                            <div>
                                <h5 class="mb-1 text-dark fw-bold">üîç Reservar Nueva Hora</h5>
                                <p class="mb-0 text-muted small">Busque especialista y agende</p>
                            </div>
                            <div class="nav-card-icon bg-primary bg-opacity-10 text-primary">
                                <i class="ph-fill ph-magnifying-glass-plus" style="font-size: 1.8rem;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div onclick="navegar('citas')" class="nav-card">
                            <div>
                                <h5 class="mb-1 text-dark fw-bold">üìÖ Revisar Mis Citas</h5>
                                <p class="mb-0 text-muted small">Ver historial o cancelar</p>
                            </div>
                            <div class="nav-card-icon bg-success bg-opacity-10 text-success">
                                <i class="ph-fill ph-calendar-check" style="font-size: 1.8rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ================= VISTA 2: BUSCAR ================= -->
        <div id="vista-buscar" class="vista">
            <div class="header-app pb-5">
                <h2 class="m-0 text-white">Reservar Hora</h2>
                <p class="m-0 text-white-50 small">Seleccione fecha y especialista</p>
            </div>

            <div class="container" style="margin-top: -35px; position: relative; z-index: 20;">
                <!-- FILTROS -->
                <div class="filtro-container p-4 bg-white rounded-4 shadow-sm border mb-4">
                    <div class="d-flex align-items-center gap-2 mb-3">
                        <i class="ph-fill ph-calendar-blank text-primary fs-4"></i>
                        <span class="fw-bold text-dark">Rango de Fechas</span>
                    </div>
                    <div class="row g-2">
                        <div class="col-6">
                            <label class="form-label-sm text-muted fw-bold small mb-1">DESDE</label>
                            <input type="date" id="fechaInicio" class="input-fecha-pro" onchange="filtrarPorFechas()">
                        </div>
                        <div class="col-6">
                            <label class="form-label-sm text-muted fw-bold small mb-1">HASTA</label>
                            <input type="date" id="fechaFin" class="input-fecha-pro" onchange="filtrarPorFechas()">
                        </div>
                    </div>
                    <div id="resultado-filtro" class="mt-3 small fw-bold text-center text-primary bg-primary bg-opacity-10 p-2 rounded-3">
                        Cargando...
                    </div>
                </div>

                <div id="lista-horas">
                    <div th:if="${#lists.isEmpty(disponibles)}" class="text-center py-5">
                        <i class="ph-duotone ph-calendar-x text-muted" style="font-size: 4rem; opacity:0.3;"></i>
                        <p class="mt-3 text-muted fw-medium">No hay horas disponibles.</p>
                    </div>

                    <div class="card-cita item-cita" th:each="hora : ${disponibles}" th:attr="data-fecha=${#temporals.format(hora.fechaHora, 'yyyy-MM-dd')}">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between mb-3">
                                <div class="d-flex gap-3 align-items-center">
                                    <div class="bg-light p-2 rounded-circle"><i class="ph-fill ph-stethoscope fs-4 text-muted"></i></div>
                                    <div>
                                        <h6 class="mb-0 fw-bold text-dark" th:text="${hora.nombreMedico}">Dr. Nombre</h6>
                                        <small class="text-muted fw-bold text-uppercase" style="font-size:0.7rem;" th:text="${hora.especialidad}">Especialidad</small>
                                    </div>
                                </div>
                                <span class="badge bg-light text-primary border border-primary-subtle rounded-pill px-3">Libre</span>
                            </div>

                            <div class="d-flex align-items-center bg-light rounded-4 p-3 mb-3">
                                <div class="date-badge me-3 bg-white shadow-sm">
                                    <div class="date-month" th:text="${#temporals.format(hora.fechaHora, 'MMM')}">DIC</div>
                                    <div class="date-day" style="color:var(--primary);" th:text="${#temporals.format(hora.fechaHora, 'dd')}">01</div>
                                </div>
                                <div class="border-start ps-3">
                                    <div class="fs-4 fw-bold text-dark" th:text="${#temporals.format(hora.fechaHora, 'HH:mm')}">00:00</div>
                                    <small class="text-muted fw-bold text-uppercase" th:text="${#temporals.format(hora.fechaHora, 'EEEE')}">D√≠a</small>
                                </div>
                            </div>

                            <button class="btn-pro btn-reservar" 
                                    th:data-id="${hora.idCita}"
                                    th:data-medico="${hora.nombreMedico}"
                                    th:data-especialidad="${hora.especialidad}"
                                    th:data-fecha="${#temporals.format(hora.fechaHora, 'dd MMMM yyyy')}"
                                    th:data-hora="${#temporals.format(hora.fechaHora, 'HH:mm')}"
                                    onclick="abrirModalConfirmacion(this)">
                                Reservar Hora <i class="ph-bold ph-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div style="height: 20px;"></div>
            </div>
        </div>

        <!-- ================= VISTA 3: MIS CITAS ================= -->
        <div id="vista-citas" class="vista">
            <div class="header-app pb-5" style="background: linear-gradient(135deg, #10b981, #047857);">
                <h2 class="m-0 text-white">Mis Citas</h2>
                <p class="m-0 text-white-50 small">Agenda confirmada</p>
            </div>

            <div class="container" style="margin-top: -35px; position: relative; z-index: 20;">
                <div th:if="${#lists.isEmpty(misCitas)}" class="text-center py-5 bg-white rounded-4 shadow-sm">
                    <i class="ph-duotone ph-calendar-blank text-success" style="font-size: 4rem; opacity:0.3;"></i>
                    <h5 class="mt-3 fw-bold text-dark">Agenda vac√≠a</h5>
                    <p class="text-muted small mb-4">No tiene horas agendadas.</p>
                    <button onclick="navegar('buscar')" class="btn btn-outline-success rounded-pill px-4 mt-2 fw-bold">Buscar Hora</button>
                </div>

                <div class="card-cita confirmada" th:each="cita : ${misCitas}">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div style="overflow: hidden; min-width: 0;">
                                <span class="badge bg-success bg-opacity-10 text-success border border-success-subtle rounded-pill px-2 mb-2">CONFIRMADA</span>
                                <h5 class="mb-0 fw-bold text-dark text-truncate" th:text="${cita.nombreMedico}">Dr. Nombre</h5>
                                <small class="text-muted text-truncate d-block" th:text="${cita.especialidad}">Especialidad</small>
                            </div>
                            <div class="bg-success bg-opacity-10 p-2 rounded-circle text-success flex-shrink-0">
                                <i class="ph-fill ph-check-circle fs-4"></i>
                            </div>
                        </div>

                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div class="date-badge border">
                                <div class="date-month text-success" th:text="${#temporals.format(cita.fechaHora, 'MMM')}">MES</div>
                                <div class="date-day text-dark" th:text="${#temporals.format(cita.fechaHora, 'dd')}">01</div>
                            </div>
                            <div>
                                <div class="fs-5 fw-bold text-dark" th:text="${#temporals.format(cita.fechaHora, 'HH:mm')}">Hora</div>
                                <small class="text-muted">Horario de atenci√≥n</small>
                            </div>
                        </div>

                        <!-- BOT√ìN CANCELAR CON MODAL -->
                        <button class="btn-pro btn-cancelar"
                                th:data-id="${cita.idCita}"
                                th:data-medico="${cita.nombreMedico}"
                                th:data-fecha="${#temporals.format(cita.fechaHora, 'dd-MM-yyyy')}"
                                th:data-hora="${#temporals.format(cita.fechaHora, 'HH:mm')}"
                                onclick="abrirModalCancelar(this)">
                            <i class="ph-bold ph-x"></i> Cancelar Cita
                        </button>
                    </div>
                </div>
                <div style="height: 20px;"></div>
            </div>
        </div>

        <!-- ================= VISTA 4: PERFIL ================= -->
        <div id="vista-perfil" class="vista">
            <div class="header-app pb-5" style="background: linear-gradient(135deg, #334155, #0f172a);">
                <h2 class="m-0 text-white">Perfil</h2>
                <p class="m-0 text-white-50 small">Mi cuenta</p>
            </div>
            <div class="container" style="margin-top: -35px; position: relative; z-index: 20;">
                <div class="card-cita p-4">
                    <div class="text-center mb-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle" style="width:90px; height:90px;">
                            <i class="ph-fill ph-user" style="font-size: 3.5rem; color: #94a3b8;"></i>
                        </div>
                        <h4 class="mt-3 mb-1 text-dark" th:text="${usuario.nombreCompleto}">Nombre</h4>
                        <span class="badge bg-light text-dark border rounded-pill px-3">PACIENTE</span>
                    </div>

                    <div class="list-group list-group-flush mb-4 rounded-4 overflow-hidden border">
                        <div class="list-group-item d-flex justify-content-between align-items-center p-3 gap-3">
                            <span class="text-muted small fw-bold flex-shrink-0">CORREO</span>
                            <span class="fw-medium text-end text-truncate text-dark" th:text="${usuario.email}">email@ejemplo.com</span>
                        </div>
                    </div>

                    <a href="/logout" class="btn btn-outline-danger w-100 rounded-4 py-3 fw-bold border-2">
                        Cerrar Sesi√≥n
                    </a>
                </div>
            </div>
        </div>

        <!-- MEN√ö FLOTANTE INFERIOR -->
        <nav class="bottom-nav">
            <div onclick="navegar('inicio')" class="nav-item active" id="btn-inicio">
                <i class="ph-fill ph-house"></i> Inicio
            </div>
            <div onclick="navegar('buscar')" class="nav-item" id="btn-buscar">
                <i class="ph-bold ph-magnifying-glass"></i> Buscar
            </div>
            <div onclick="navegar('citas')" class="nav-item" id="btn-citas">
                <i class="ph-bold ph-calendar-check"></i> Citas
            </div>
            <div onclick="navegar('perfil')" class="nav-item" id="btn-perfil">
                <i class="ph-fill ph-user-circle"></i> Perfil
            </div>
        </nav>

        <!-- MODAL CONFIRMACI√ìN (RESERVAR) -->
        <div class="modal fade" id="modalConfirmar" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content rounded-4 border-0">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold text-dark ps-2">Confirmar Cita</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="detalle-confirmacion p-3 bg-light rounded-4 mb-3 border border-light-subtle">
                            <!-- Datos Completos -->
                            <div class="text-muted small fw-bold mb-1">M√âDICO</div>
                            <div class="fs-5 fw-bold text-primary mb-3" id="modalMedico">Dr. Nombre</div>

                            <div class="text-muted small fw-bold mb-1">ESPECIALIDAD</div>
                            <div class="fs-5 fw-bold text-dark" id="modalEspecialidad">Cardiolog√≠a</div>

                            <hr class="opacity-10 my-3">

                            <div class="row">
                                <div class="col-6 border-end">
                                    <div class="text-muted small fw-bold">FECHA</div>
                                    <div class="fs-5 fw-bold text-dark" id="modalFecha">--</div>
                                </div>
                                <div class="col-6 ps-3">
                                    <div class="text-muted small fw-bold">HORA</div>
                                    <div class="text-dark fw-bold" id="modalHora">--:--</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-center text-muted small mb-0 mt-3">Se enviar√° un comprobante a su correo.</p>
                    </div>
                    <div class="modal-footer flex-column border-0 pt-0 px-4 pb-4">
                        <form action="/reservar" method="post" class="w-100">
                            <input type="hidden" name="idCita" id="modalIdCita"/>
                            <button type="submit" class="btn-pro btn-reservar rounded-pill shadow-lg">‚úÖ S√ç, CONFIRMAR</button>
                        </form>
                        <button type="button" class="btn btn-link text-muted mt-2 text-decoration-none small" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL CANCELAR (NUEVO: HU-2) -->
        <div class="modal fade" id="modalCancelar" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content rounded-4 border-0">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold text-danger ps-2">Cancelar Cita</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4 text-center">

                        <i class="ph-duotone ph-warning-circle text-danger mb-3" style="font-size: 3rem;"></i>

                        <p class="fw-bold text-dark mb-2">¬øRealmente desea cancelar esta cita?</p>

                        <div class="alert-regla d-flex align-items-start gap-2 text-start p-3 bg-danger-subtle rounded-3 text-danger border border-danger-subtle">
                            <i class="ph-fill ph-info fs-5 flex-shrink-0"></i>
                            <small class="fw-bold">Regla de Negocio: Solo puede cancelar hasta 24 horas antes de la atenci√≥n.</small>
                        </div>

                        <p class="text-muted small mb-0 mt-3">Esta acci√≥n liberar√° la hora para otro paciente.</p>
                    </div>
                    <div class="modal-footer flex-column border-0 pt-0 px-4 pb-4">
                        <form action="/cancelar" method="post" class="w-100">
                            <input type="hidden" name="idCita" id="modalCancelId"/>
                            <button type="submit" class="btn-pro btn-confirmar-cancelacion shadow-lg bg-danger border-0">S√ç, CANCELAR CITA</button>
                        </form>
                        <button type="button" class="btn btn-link text-muted mt-2 text-decoration-none small" data-bs-dismiss="modal">Volver atr√°s</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
                function navegar(vista) {
                    document.querySelectorAll('.vista').forEach(el => el.classList.remove('vista-activa'));
                    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                    document.getElementById('vista-' + vista).classList.add('vista-activa');
                    document.getElementById('btn-' + vista).classList.add('active');
                    window.scrollTo(0, 0);
                }

                function filtrarPorFechas() {
                    const inicio = document.getElementById('fechaInicio').value;
                    const fin = document.getElementById('fechaFin').value;
                    const cards = document.querySelectorAll('.item-cita');
                    let count = 0;
                    const feedback = document.getElementById('resultado-filtro');

                    feedback.innerText = 'Buscando...';

                    setTimeout(() => {
                        cards.forEach(c => {
                            const fecha = c.getAttribute('data-fecha');
                            let show = true;
                            if (inicio && fecha < inicio)
                                show = false;
                            if (fin && fecha > fin)
                                show = false;
                            c.style.display = show ? 'block' : 'none';
                            if (show)
                                count++;
                        });
                        feedback.innerHTML = count > 0 ? `‚úÖ ${count} horas encontradas` : '‚ùå No hay horas en este rango';
                    }, 100);
                }

                function abrirModalConfirmacion(btn) {
                    document.getElementById('modalIdCita').value = btn.getAttribute('data-id');
                    document.getElementById('modalMedico').innerText = btn.getAttribute('data-medico');
                    document.getElementById('modalEspecialidad').innerText = btn.getAttribute('data-especialidad');
                    document.getElementById('modalFecha').innerText = btn.getAttribute('data-fecha');
                    document.getElementById('modalHora').innerText = btn.getAttribute('data-hora');
                    new bootstrap.Modal(document.getElementById('modalConfirmar')).show();
                }

                // Nueva Funci√≥n para el Modal de Cancelar
                function abrirModalCancelar(btn) {
                    const id = btn.getAttribute('data-id');
                    document.getElementById('modalCancelId').value = id;
                    new bootstrap.Modal(document.getElementById('modalCancelar')).show();
                }

                window.onload = function () {
                    const inputInicio = document.getElementById('fechaInicio');
                    const inputFin = document.getElementById('fechaFin');
                    if (inputInicio && inputFin) {
                        inputInicio.value = "2025-12-01";
                        inputFin.value = "2025-12-31";
                        filtrarPorFechas();
                    }
                };
        </script>
    </body>
</html>